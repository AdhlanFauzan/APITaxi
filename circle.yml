machine:
    python:
        version: 2.7.9
    services:
        - postgresql
    pre:
        - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.6 10
        - sudo apt-get install autoconf-archive automake-1.14 autoconf2.59 build-essential check libspatialindex-dev

checkout:
    pre:
        - git clone https://github.com/openmaraude/faker && cd faker && go build && cd ..
        - git clone https://github.com/openmaraude/minimal_operateur_server

dependencies:
    pre:
        - git clone https://github.com/openmaraude/GeoTaxi
        - cd GeoTaxi/src && mkdir obj && make && cd ../..
        - ./install_redis.sh
        - ./install_yajl.sh
        - ./install_krmt.sh
        - wget https://bootstrap.pypa.io/get-pip.py && python get-pip.py
    cache_directories:
        - redis
        - yajl
        - krmt

test:
    pre:
        - ./redis/src/redis-server --module-add krmt/geo.so --port 7777
        - ./GeoTaxi/src/geoloc-server 8080
        - ./faker/faker 
    override:
        - APITAXI_CONFIG_FILE=circle_settings.py nosetests tests
